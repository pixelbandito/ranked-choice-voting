(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{232:function(e,t,a){e.exports=a(496)},237:function(e,t,a){},238:function(e,t,a){},496:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(229),o=a.n(r),i=(a(237),a(8)),c=a(9),d=a(11),s=a(10),u=a(12),m=(a(238),a(98)),p=a(32),b=a(39),h=a(150),v=a.n(h),f=a(49),g=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).handleClickButton=function(){a.props.firebase.login({provider:"google",type:"popup"})},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.auth;return l.a.createElement("div",this.props,l.a.createElement("button",{onClick:this.handleClickButton},"Click me!",Object(b.isLoaded)(e)?Object(b.isEmpty)(e)?l.a.createElement("span",null,"Not Authed"):l.a.createElement("pre",null,JSON.stringify(e,null,2)):l.a.createElement("span",null,"Loading...")))}}]),t}(n.Component),O=(Object(p.c)(b.withFirebase,Object(m.b)(function(e){return{auth:e.firebase.auth}}))(g),a(24)),C=a(25),E=a(4),j=a(31),y=a.n(j),w=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={polls:{},newCandidateName:""},a.updatePolls=function(e){var t=e.nextPolls,n=e.prevPolls;t&&JSON.stringify(n)!==JSON.stringify(t)&&a.setState({polls:t})},a.getCandidateById=function(e){var t=e.candidateId;return e.candidates.find(function(e){return e.id===t})},a.getCandidateByName=function(e){var t=e.candidateName;return e.candidates.find(function(e){return e.name===t})},a.getAddCandidateDisabled=function(){var e=a.props.activePoll.candidates,t=a.state.newCandidateName;return!t||a.getCandidateByName({candidateName:t,candidates:e})},a.submitAddCandidateForm=function(e){return e.stopPropagation(),e.preventDefault(),a.addCandidate()},a.addCandidate=function(){var e=a.props,t=e.activePoll,n=e.setPoll,l=a.state.newCandidateName;a.getAddCandidateDisabled()||(a.setState({newCandidateName:""}),n(Object(E.a)({},t,{candidates:[].concat(Object(C.a)(t.candidates),[{name:l,id:y.a.generate()}])})))},a.changeNewCandidateNameInput=function(e){var t=e.target.value;a.setState(function(e){return Object(E.a)({},e,{newCandidateName:t})})},a.submitForm=function(e){(0,a.props.setPolls)(a.state.polls),e.preventDefault()},a.renderNewCandidateForm=function(){var e=a.state.newCandidateName;return l.a.createElement("li",{key:"newCandidate"},l.a.createElement("form",{disabled:a.getAddCandidateDisabled(),onSubmit:a.submitAddCandidateForm},l.a.createElement("label",{htmlFor:"newCandidate"},"New candidate"),l.a.createElement("input",{id:"newCandidate",placeholder:"Candidate name",type:"text",value:e,onChange:a.changeNewCandidateNameInput}),l.a.createElement("button",{disabled:a.getAddCandidateDisabled()},"Add candidate")))},a.handleChangeCandidateNameInput=function(e){return function(t){var n=a.props.activePoll.candidates,l=t.target.value;l&&!a.getCandidateByName({candidates:n,candidateName:l})&&(a.setState(function(t){var n=a.props.activePoll,r=t.polls,o=n.candidates,i=Object(C.a)(o);return i.splice(o.indexOf(e),1,Object(E.a)({},e,{name:l})),{polls:Object(E.a)({},r,Object(O.a)({},n.id,Object(E.a)({},n,{candidates:i})))}}),t.stopPropagation())}},a.renderCandidates=function(){var e=a.props.activePoll.candidates.map(function(e){return l.a.createElement("li",{key:e.id},l.a.createElement("label",{htmlFor:e.id},"Candidate"),l.a.createElement("input",{id:e.id,onChange:a.handleChangeCandidateNameInput(e),placeholder:"Candidate name",type:"text",value:e.name}))});return[].concat(Object(C.a)(e),[a.renderNewCandidateForm()])},a.handleChangePollNameInput=function(e){var t=a.props.activePoll,n=a.state.polls,l=e.target.value||t.name;a.setState(function(e){return{polls:Object(E.a)({},n,Object(O.a)({},t.id,Object(E.a)({},t,{name:l})))}})},a.handleChangeEnabledCheckbox=function(e){var t=a.props.activePoll,n=e.target.checked;a.setState(function(e){return{polls:Object(E.a)({},e.polls,Object(O.a)({},t.id,Object(E.a)({},t,{enabled:n})))}})},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.polls,t=this.state.polls;this.updatePolls({nextPolls:e,prevPolls:t})}},{key:"componentDidUpdate",value:function(e){var t=this.props.polls,a=e.polls;this.updatePolls({nextPolls:t,prevPolls:a})}},{key:"render",value:function(){var e=this.props.activePoll,t=e.enabled,a=e.name;return l.a.createElement("div",null,l.a.createElement("label",{htmlFor:"pollSelect"},"Select poll"),l.a.createElement("select",{id:"pollSelect",onChange:this.handleChangePollSelect,defaultValue:"placeholder"},l.a.createElement("option",{disabled:!0,value:"placeholder"},"Select a poll"),l.a.createElement("option",{value:"create"},"Create a new poll")),l.a.createElement("form",{id:"pollForm",onSubmit:this.submitForm},l.a.createElement("h1",null,"Poll"),l.a.createElement("section",null,l.a.createElement("label",{htmlFor:"name"},"Poll name"),l.a.createElement("input",{type:"text",onChange:this.handleChangePollNameInput,value:a}))),l.a.createElement("section",null,l.a.createElement("ul",null,this.renderCandidates())),l.a.createElement("section",null,l.a.createElement("label",{htmlFor:"toggleEnabled"},l.a.createElement("input",{id:"toggleEnabled",onChange:this.handleChangeEnabledCheckbox,type:"checkbox",checked:t}),"Enable")),l.a.createElement("button",{type:"button"},"Cancel"),l.a.createElement("button",{onClick:this.submitForm,type:"button"},"Save"))}}]),t}(n.Component),S=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).state={ballots:[],candidateRanks:[],voterName:""},a.updateShuffledCandidatesFromProps=function(e){var t=e.prevProps,n=void 0===t?{}:t,l=e.nextProps,r=void 0===l?{}:l,o=e.forceUpdate,i=void 0!==o&&o,c=r.activePoll,d=n.activePoll,s=(c||{}).candidates,u=void 0===s?[]:s,m=(d||{}).candidates,p=void 0===m?[]:m;if(JSON.stringify(u)!==JSON.stringify(p)||i){var b=Object(C.a)(u);b.sort(function(){return Math.random()>.5?1:-1});var h=b.map(function(e){return e.id});a.setState({candidateRanks:h})}},a.onChangeCandidateRankInput=function(e){return function(t){var n=a.state.candidateRanks,l=t.target.value;if(l){var r=Object(C.a)(n);r.splice(n.indexOf(e),1),r.splice(l,0,e),a.setState({candidateRanks:r})}}},a.handleChangeVotertNameInput=function(e){return a.setState({voterName:e.target.value})},a.handleSubmitBallotForm=function(e){var t=a.props,n=t.activePoll,l=(n=void 0===n?{}:n).id,r=void 0===l?null:l,o=t.addBallot,i=a.state,c=i.candidateRanks,d=i.voterName;e.preventDefault(),o({candidateRanks:c,dateSubmitted:(new Date).valueOf(),submitted:!0,id:y.a.generate(),pollId:r,voterName:d}),a.setState({voterName:""}),a.updateShuffledCandidatesFromProps({nextProps:a.props,forceUpdate:!0})},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.updateShuffledCandidatesFromProps({nextProps:this.props})}},{key:"componentDidUpdate",value:function(e){this.updateShuffledCandidatesFromProps({nextProps:this.props,prevProps:e})}},{key:"render",value:function(){var e=this,t=this.props.activePoll,a=this.state,n=a.candidateRanks,r=a.voterName,o=(t||{}).candidates,i=void 0===o?[]:o;return l.a.createElement("div",null,l.a.createElement("h1",null,"Ballot"),l.a.createElement("form",{onSubmit:this.handleSubmitBallotForm},l.a.createElement("section",null,l.a.createElement("label",{htmlFor:"voterName"},"Your name"),l.a.createElement("input",{id:"voterName",type:"text",onChange:this.handleChangeVotertNameInput,value:r})),l.a.createElement("section",null,l.a.createElement("ul",null,n.map(function(t,a){var n=i.find(function(e){return e.id===t});return l.a.createElement("li",{key:n.id},l.a.createElement("label",{htmlFor:"candidateRankInput--".concat(n.id)},"Candidate rank",l.a.createElement("br",null),l.a.createElement("strong",null,n.name)),l.a.createElement("input",{id:"candidateRankInput--".concat(n.id),min:"0",max:i.length-1,step:"1",type:"number",value:a,onChange:e.onChangeCandidateRankInput(n.id)}))}))),l.a.createElement("section",null,l.a.createElement("button",{type:"submit",disabled:!r},"Submit"))))}}]),t}(n.Component),k=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).state={polls:{}},a.setPolls=function(e){a.setState({polls:e});var t=JSON.stringify(e);window.localStorage.setItem("polls",t)},a.setPoll=function(e){var n=a.state.polls;a.setPolls(Object(E.a)({},n,Object(O.a)({},e.id,Object(E.a)({},t.defaultBallot,n[e.id],e))))},a.getActivePoll=function(){var e=a.state.polls,n=Object.keys(e).length?Object.keys(e)[0]:null;return n?e[n]:Object(E.a)({},t.defaultPoll)},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({polls:t.updatePollsFromLocalStorage()})}},{key:"render",value:function(){var e=this.props,t=e.children,a=Object(f.a)(e,["children"]),n=this.state.polls;return l.a.cloneElement(t,Object(E.a)({},a,{activePoll:this.getActivePoll(),addPoll:this.addPoll,polls:n,setPolls:this.setPolls,setPoll:this.setPoll}))}}]),t}(n.Component);k.defaultPoll={candidates:[],enabled:!1,id:y.a.generate(),name:"",dateCreated:null,dateUpdated:null,dateEnabled:null},k.updatePollsFromLocalStorage=function(){var e=window.localStorage.getItem("polls"),t={};try{t=JSON.parse(e)||t}catch(a){console.warn("Couldn't load polls, they'll be overwritten")}return t};var P=k,N=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).state={ballots:{}},a.setBallots=function(e){a.setState({ballots:e});var t=JSON.stringify(e);window.localStorage.setItem("ballots",t)},a.addBallot=function(e){var n=a.state.ballots;a.setBallots(Object(E.a)({},n,Object(O.a)({},e.id,Object(E.a)({},t.defaultBallot,n[e.id],e))))},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({ballots:t.getBallotsFromLocalStorage()})}},{key:"render",value:function(){var e=this.props,t=e.children,a=Object(f.a)(e,["children"]),n=this.state.ballots;return l.a.cloneElement(t,Object(E.a)({},a,{ballots:n,addBallot:this.addBallot}))}}]),t}(n.Component);N.defaultBallot={candidateRanks:[],dateSubmitted:null,submitted:!1,id:y.a.generate(),pollId:"",voterName:""},N.getBallotsFromLocalStorage=function(){var e=window.localStorage.getItem("ballots"),t={};try{t=JSON.parse(e)||t}catch(a){console.warn("Couldn't load ballots, they'll be overwritten")}return t};var I=N,A=a(61),F=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).state={winnerIds:[],errorMessage:""},a.calculateWinner=function(){},a.handleClickCalculateWinners=function(){var e=a.props,n=e.activePoll,l=e.ballots,r=t.getActivePollSortedBallotsArray({poll:n,ballots:l}),o=r.length/2,i=Object(C.a)(n.candidates);a.setState({errorMessage:"",winnerIds:[]});try{var c=t.calculateResults({ballotsArray:r,candidates:i,winningThreshold:o}).winnerIds;a.setState({winnerIds:c})}catch(d){a.setState({errorMessage:d.message})}},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,a=e.ballots,n=e.activePoll,r=this.state,o=r.errorMessage,i=r.winnerIds,c=t.getActivePollSortedBallotsArray({poll:n,ballots:a});return l.a.createElement("div",null,l.a.createElement("h1",null,"<Results />"),l.a.createElement("h2",null,c.length," ballot",1===c.length?"":"s"),l.a.createElement("ul",null,c.map(function(e){return l.a.createElement("li",{key:e.id},l.a.createElement("em",null,new Date(e.dateSubmitted).toLocaleString()),l.a.createElement("br",null),l.a.createElement("pre",null,JSON.stringify(e)))})),l.a.createElement("button",{onClick:this.handleClickCalculateWinners},"Calculate winners"),!!i.length&&l.a.createElement("div",{className:"Results__winners"},l.a.createElement("strong",null,"Congratulations!"),l.a.createElement("ul",null,i.map(function(e){var t=n.candidates.find(function(t){return t.id===e});return t?l.a.createElement("li",{key:t.id},t.name):null}))),o&&l.a.createElement("div",{className:"Results__errorMessage"},o))}}]),t}(n.Component);F.getActivePollSortedBallotsArray=function(e){var t=e.poll,a=e.ballots;return Object.entries(a).filter(function(e){var a=Object(A.a)(e,2);a[0];return a[1].pollId===t.id}).sort(function(e,t){var a=Object(A.a)(e,2),n=(a[0],a[1]),l=Object(A.a)(t,2),r=(l[0],l[1]);return n.dateSubmitted>r.dateSubmitted?-1:1}).map(function(e){var t=Object(A.a)(e,2);t[0];return t[1]})},F.getRoundVotes=function(e){var t=e.ballotsArray,a=e.round,n=void 0===a?0:a;return t.reduce(function(e,t){var a=t.candidateRanks;if(a.length>n){var l=a[n];e[l]=(e[l]||0)+1}return e},{})},F.calculateResults=function(e){var t=e.ballotsArray,a=e.candidates,n=e.roundIndex,l=void 0===n?1:n,r=e.winningThreshold,o=F.getRoundVotes({ballotsArray:t});console.log("calculateResults",{candidates:a,ballotsArray:t,winningThreshold:r,roundIndex:l,votes:o});var i=a.map(function(e){return e.id});if(!i.length&&1===l)throw new Error("Coulnd't find any candidates.");if(!i.length)throw new Error("All candidates have been eliminated.");var c=i.filter(function(e){return o[e]&&o[e]>r});if(c.length)return console.log("We have some winners!",{winnerIds:c}),{winnerIds:c};console.log("No winner yet...");var d=i.reduce(function(e,t){var a=o[t]||0;return e=(e="number"===typeof e?e:a)<=a?e:a},null),s=a.map(function(e){return e.id}).filter(function(e){return(o[e]||0)===d}),u=Object(C.a)(t);if(!s.length)throw new Error("Couldn't determine losers to remove for next round");console.log("We have some losers!",{loserIds:s});var m=a.filter(function(e){return s.indexOf(e.id)<0});u=u.map(function(e){return Object(E.a)({},e,{candidateRanks:e.candidateRanks.filter(function(e){return s.indexOf(e)<0})})}),console.log({nextCandidates:m,nextBallotsArray:u});try{return F.calculateResults({ballotsArray:u,candidates:m,roundIndex:l+1,winningThreshold:r})}catch(p){if("All candidates have been eliminated."===p.message)return{winnerIds:i};throw p}};var x=F,B=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).state={tab:"pollForm"},a.handleClickSetTab=function(e){return function(t){return a.setState({tab:e})}},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.auth,Object(f.a)(e,["auth"])),a=this.state.tab;return l.a.createElement("div",t,l.a.createElement("div",{className:"tabs"},l.a.createElement("button",{className:"tab",onClick:this.handleClickSetTab("pollForm")},"Poll editor"),l.a.createElement("button",{className:"tab",onClick:this.handleClickSetTab("ballot")},"Ballot"),l.a.createElement("button",{className:"tab",onClick:this.handleClickSetTab("results")},"Results")),"pollForm"===a&&l.a.createElement(P,null,l.a.createElement(w,null)),"ballot"===a&&l.a.createElement(P,null,l.a.createElement(I,null,l.a.createElement(S,null))),"results"===a&&l.a.createElement(P,null,l.a.createElement(I,null,l.a.createElement(x,null))),!1)}}]),t}(n.Component);v.a.initializeApp({apiKey:"AIzaSyBdsGFx0j9svg0lfxEHqiWoiUuFywN6tSg",authDomain:"ranked-choice-voting-805a0.firebaseapp.com",databaseURL:"https://ranked-choice-voting-805a0.firebaseio.com",projectId:"ranked-choice-voting-805a0",storageBucket:"ranked-choice-voting-805a0.appspot.com",messagingSenderId:"860983913109"});var R=Object(p.c)(Object(b.reactReduxFirebase)(v.a,{userProfile:"users"}))(p.d)(Object(p.b)({firebase:b.firebaseReducer}),{}),D=function(e){function t(){return Object(i.a)(this,t),Object(d.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return l.a.createElement(m.a,{store:R},l.a.createElement("div",{className:"App"},l.a.createElement(B,null)))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(l.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[232,1,2]]]);
//# sourceMappingURL=main.86c6a9e0.chunk.js.map