(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{16:function(e,t,a){e.exports=a(34)},22:function(e,t,a){},23:function(e,t,a){},34:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(15),o=a.n(r),i=(a(22),a(2)),c=a(3),d=a(5),u=a(4),s=a(6),p=(a(23),a(9)),m=l.a.createContext(null),v=function(e){var t=e.polls,a=e.setActivePollId,n=function(e){var t=e.target.value;a(t)},r=Object.values(t);return r.sort(function(e,t){return e.name.localeCompare(t.name)}),l.a.createElement(m.Consumer,null,function(e){return l.a.createElement("select",{onChange:n,value:e||"_placeholder"},l.a.createElement("option",{value:"placeholder",disabled:!0},"Choose an active poll"),r.map(function(e){return l.a.createElement("option",{key:e.id,value:e.id},e.name)}),l.a.createElement("option",{key:"create",value:"_create"},"Create a new poll"))})},h=a(1),b=a(11),f=function(e){var t=e.children,a=Object(p.a)(e,["children"]),r=a.polls,o=Object(n.useState)(),i=Object(b.a)(o,2),c=i[0],d=i[1];if(!c){var u=Object.values(r);u.sort(function(e,t){return(e.dateUpdated>t.dateUpdated?-1:e.dateUpdated>t.dateUpdated&&1)||0});var s=u.length>0?u[0].id:null;d(s)}return console.log(l.a.Children.map(t,function(e){return console.log(e)})),l.a.createElement(m.Provider,{value:c},l.a.Children.map(t,function(e){return l.a.isValidElement(e)?l.a.cloneElement(e,Object(h.a)({},a,{setActivePollId:d})):e}))},C=a(10),g=a(8),O=a.n(g),E=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).getCandidateById=function(e){var t=e.candidateId;return e.candidates.find(function(e){return e.id===t})},a.getCandidateByName=function(e){var t=e.candidateName;return e.candidates.find(function(e){return e.name===t})},a.getAddCandidateDisabled=function(){var e=a.props,t=e.activePoll.candidates,n=e.newCandidateName;return!n||a.getCandidateByName({candidateName:n,candidates:t})},a.submitAddCandidateForm=function(e){return e.stopPropagation(),e.preventDefault(),a.addCandidate()},a.addCandidate=function(){var e=a.props,t=e.activePoll,n=e.newCandidateName,l=e.onChangeNewCandidateName,r=e.onChangePoll;a.getAddCandidateDisabled()||(l(""),r(Object(h.a)({},t,{candidates:[].concat(Object(C.a)(t.candidates),[{name:n,id:O.a.generate()}])})))},a.handleChangeNewCandidateNameInput=function(e){(0,a.props.onChangeNewCandidateName)(e.target.value)},a.handleCancelForm=function(e){(0,a.props.revertPoll)(),e.preventDefault()},a.handleSubmitForm=function(e){var t=a.props,n=t.activePoll;(0,t.onSubmitPoll)(n),e.preventDefault()},a.renderNewCandidateForm=function(){var e=a.props.newCandidateName;return l.a.createElement("li",{key:"newCandidate"},l.a.createElement("form",{disabled:a.getAddCandidateDisabled(),onSubmit:a.submitAddCandidateForm},l.a.createElement("label",{htmlFor:"newCandidate"},"New candidate"),l.a.createElement("input",{id:"newCandidate",placeholder:"Candidate name",type:"text",value:e,onChange:a.handleChangeNewCandidateNameInput}),l.a.createElement("button",{disabled:a.getAddCandidateDisabled()},"Add candidate")))},a.handleChangeCandidateNameInput=function(e){return function(t){var n=a.props,l=n.activePoll,r=n.onChangePoll,o=l.candidates,i=t.target.value;if(i&&!a.getCandidateByName({candidates:o,candidateName:i})){var c=Object(C.a)(o);c.splice(o.indexOf(e),1,Object(h.a)({},e,{name:i})),r(Object(h.a)({},l,{candidates:c})),t.stopPropagation()}}},a.renderCandidates=function(){var e=a.props.activePoll.candidates.map(function(e){return l.a.createElement("li",{key:e.id},l.a.createElement("label",{htmlFor:e.id},"Candidate"),l.a.createElement("input",{id:e.id,onChange:a.handleChangeCandidateNameInput(e),placeholder:"Candidate name",type:"text",value:e.name}))});return[].concat(Object(C.a)(e),[a.renderNewCandidateForm()])},a.handleChangePollNameInput=function(e){var t=a.props,n=t.activePoll,l=t.onChangePoll,r=e.target.value||n.name;l(Object(h.a)({},n,{name:r}))},a.handleChangeEnabledCheckbox=function(e){var t=a.props,n=t.activePoll,l=t.onChangePoll,r=e.target.checked;l(Object(h.a)({},n,{enabled:r}))},a}return Object(s.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.activePoll,t=e.enabled,a=e.name;return l.a.createElement("div",null,l.a.createElement("form",{id:"pollForm",onSubmit:this.handleSubmitForm},l.a.createElement("h1",null,"Poll"),l.a.createElement("section",null,l.a.createElement("label",{htmlFor:"name"},"Poll name"),l.a.createElement("input",{type:"text",onChange:this.handleChangePollNameInput,value:a}))),l.a.createElement("section",null,l.a.createElement("ul",null,this.renderCandidates())),l.a.createElement("section",null,l.a.createElement("label",{htmlFor:"toggleEnabled"},l.a.createElement("input",{id:"toggleEnabled",onChange:this.handleChangeEnabledCheckbox,type:"checkbox",checked:t}),"Enable")),l.a.createElement("button",{onClick:this.handleCancelForm,type:"button"},"Cancel"),l.a.createElement("button",{onClick:this.handleSubmitForm,type:"button"},"Save"))}}]),t}(n.Component),P=a(7),j=a.n(P),w={id:j.a.string.isRequired,name:j.a.string.isRequired},y={candidates:[],dateCreated:new Date(0).valueOf(),dateUpdated:new Date(0).valueOf(),enabled:!1,id:"",name:""},S=function(e){return Object(h.a)({},y,{dateCreated:(new Date).valueOf(),dateUpdated:(new Date).valueOf(),id:O.a.generate()},e)},k=(j.a.arrayOf(j.a.shape(w)).isRequired,j.a.number.isRequired,j.a.number.isRequired,j.a.bool.isRequired,j.a.string.isRequired,j.a.string.isRequired,function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(l)))).state={activePoll:null,newCandidateName:"",prevContext:a.context},a.updateActivePoll=function(e){var t=e.activePollId,n=(e.prevActivePollId,e.props.polls);e.prevProps.polls;if(n&&n[t]){var l=n[t];if(!l)throw new Error("Couldn't find your poll in the list");return a.setState({activePoll:Object(h.a)({},l),prevContext:a.context})}var r=S();return a.setState({activePoll:r,prevContext:a.context})},a.handleSubmitPoll=function(){var e=a.props,t=e.setActivePollId,n=e.setPoll,l=a.state.activePoll;n(l),t(l.id)},a.handleChangeNewCandidateName=function(e){return a.setState({newCandidateName:e})},a.handleChangePoll=function(e){return a.setState({activePoll:Object(h.a)({},e,{dateUpdated:(new Date).valueOf()})})},a}return Object(s.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.updateActivePoll({activePollId:this.context,prevActivePollId:null,prevProps:{},props:this.props})}},{key:"componentDidUpdate",value:function(e){var t=this.state.prevContext;this.context!==t&&this.updateActivePoll({activePollId:this.context,prevActivePollId:t,prevProps:e,props:this.props})}},{key:"render",value:function(){var e=this,t=this.props,a=t.children,n=(t.polls,Object(p.a)(t,["children","polls"])),r=this.state,o=r.activePoll,i=r.newCandidateName;return!o||0===Object.entries(o).length&&o.constructor===Object?null:l.a.createElement(l.a.Fragment,null,l.a.Children.map(a,function(t){return l.a.isValidElement(t)?l.a.cloneElement(t,Object(h.a)({},n,{activePoll:o,newCandidateName:i,onRevertPoll:e.handleRevertPoll,onChangeNewCandidateName:e.handleChangeNewCandidateName,onChangePoll:e.handleChangePoll,onSubmitPoll:e.handleSubmitPoll})):t}))}}]),t}(n.Component));k.contextType=m;var N=k,I=function(e){return l.a.createElement(N,e,l.a.createElement(E,null))},A=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(l)))).state={ballots:[],candidateRanks:[],voterName:"",prevContext:a.context},a.updateShuffledCandidatesFromProps=function(e){var t=e.activePollId,n=e.prevActivePollId,l=e.props,r=e.prevProps,o=e.forceUpdate,i=void 0!==o&&o,c=t&&l.polls&&l.polls[t]||{},d=n&&r.polls&&r.polls[n]||{},u=c.candidates,s=void 0===u?[]:u,p=d.candidates,m=void 0===p?[]:p,v={};if(t!==n&&(v=Object(h.a)({},v,{prevContext:t})),JSON.stringify(s)!==JSON.stringify(m)||i){var b=Object(C.a)(s);b.sort(function(){return Math.random()>.5?1:-1});var f=b.map(function(e){return e.id});v=Object(h.a)({},v,{candidateRanks:f})}Object.keys(v).length&&a.setState(Object(h.a)({},v))},a.onChangeCandidateRankInput=function(e){return function(t){var n=a.state.candidateRanks,l=t.target.value;if(l){var r=Object(C.a)(n);r.splice(n.indexOf(e),1),r.splice(l,0,e),a.setState({candidateRanks:r})}}},a.handleChangeVotertNameInput=function(e){return a.setState({voterName:e.target.value})},a.handleSubmitBallotForm=function(e){var t=a.props,n=t.polls,l=t.addBallot,r=a.state,o=r.candidateRanks,i=r.voterName,c=(a.context&&(n[a.context]||{})).id,d=void 0===c?null:c;e.preventDefault(),l({candidateRanks:o,dateSubmitted:(new Date).valueOf(),submitted:!0,id:O.a.generate(),pollId:d,voterName:i}),a.setState({voterName:""}),a.updateShuffledCandidatesFromProps({forceUpdate:!0,activePollId:a.context,props:a.props,prevActivePollId:a.context,prevProps:a.props})},a}return Object(s.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.updateShuffledCandidatesFromProps({activePollId:this.context,props:this.props,prevActivePollId:null,prevProps:{}})}},{key:"componentDidUpdate",value:function(e){var t=this.state.prevContext;this.updateShuffledCandidatesFromProps({activePollId:this.context,props:this.props,prevActivePollId:t,prevProps:e})}},{key:"render",value:function(){var e=this,t=this.props.polls,a=this.context&&(t[this.context]||{}),n=this.state,r=n.candidateRanks,o=n.voterName,i=(a||{}).candidates,c=void 0===i?[]:i;return l.a.createElement("div",null,l.a.createElement("h1",null,"Ballot"),l.a.createElement("form",{onSubmit:this.handleSubmitBallotForm},l.a.createElement("section",null,l.a.createElement("label",{htmlFor:"voterName"},"Your name"),l.a.createElement("input",{id:"voterName",type:"text",onChange:this.handleChangeVotertNameInput,value:o})),l.a.createElement("section",null,l.a.createElement("ul",null,r.map(function(t,a){var n=c.find(function(e){return e.id===t});return n?l.a.createElement("li",{key:n.id},l.a.createElement("label",{htmlFor:"candidateRankInput--".concat(n.id)},"Candidate rank",l.a.createElement("br",null),l.a.createElement("strong",null,n.name)),l.a.createElement("input",{id:"candidateRankInput--".concat(n.id),min:"0",max:c.length-1,step:"1",type:"number",value:a,onChange:e.onChangeCandidateRankInput(n.id)})):null}))),l.a.createElement("section",null,l.a.createElement("button",{type:"submit",disabled:!o},"Submit"))))}}]),t}(n.Component);A.contextType=m,A.defaultProps={addBallot:null,polls:{}};var x=A,R=a(12),F=function(){var e=window.localStorage.getItem("polls"),t={};try{t=JSON.parse(e)||t}catch(a){console.warn("Couldn't load polls, they'll be overwritten")}return t},B=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(l)))).state={polls:F()},a.setPolls=function(e){a.setState({polls:e});var t=JSON.stringify(e);window.localStorage.setItem("polls",t)},a.setPoll=function(e){var n=a.state.polls;a.setPolls(Object(h.a)({},n,Object(R.a)({},e.id,Object(h.a)({},t.defaultBallot,n[e.id],e,{dateUpdated:(new Date).valueOf()}))))},a}return Object(s.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.children,n=Object(p.a)(t,["children"]),r=this.state.polls;return r?l.a.Children.map(a,function(t){return l.a.isValidElement(t)?l.a.cloneElement(t,Object(h.a)({},n,{polls:r,setPoll:e.setPoll})):t}):l.a.createElement("div",{className:"PollsProvider__loader"})}}]),t}(n.Component),D=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(l)))).state={ballots:{}},a.setBallots=function(e){a.setState({ballots:e});var t=JSON.stringify(e);window.localStorage.setItem("ballots",t)},a.addBallot=function(e){var n=a.state.ballots;a.setBallots(Object(h.a)({},n,Object(R.a)({},e.id,Object(h.a)({},t.defaultBallot,n[e.id],e))))},a}return Object(s.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({ballots:t.getBallotsFromLocalStorage()})}},{key:"render",value:function(){var e=this.props,t=e.children,a=Object(p.a)(e,["children"]),n=this.state.ballots;return l.a.cloneElement(t,Object(h.a)({},a,{ballots:n,addBallot:this.addBallot}))}}]),t}(n.Component);D.defaultBallot={candidateRanks:[],dateSubmitted:null,submitted:!1,id:O.a.generate(),pollId:"",voterName:""},D.getBallotsFromLocalStorage=function(){var e=window.localStorage.getItem("ballots"),t={};try{t=JSON.parse(e)||t}catch(a){console.warn("Couldn't load ballots, they'll be overwritten")}return t};var U=D,M=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(l)))).state={activePoll:{},errorMessage:"",prevActivePollId:null,winnerIds:[]},a.updateActivePollFromProps=function(){var e=a.props.polls,t=a.context;t!==a.state.prevActivePollId&&a.setState({prevActivePollId:t,activePoll:t&&e&&e[t]||{}})},a.calculateWinner=function(){},a.handleClickCalculateWinners=function(){var e=a.props.ballots,n=a.state.activePoll,l=t.getPollSortedBallotsArray({poll:n,ballots:e}),r=l.length/2,o=Object(C.a)(n.candidates);a.setState({errorMessage:"",winnerIds:[]});try{var i=t.calculateResults({ballotsArray:l,candidates:o,winningThreshold:r}).winnerIds;a.setState({winnerIds:i})}catch(c){a.setState({errorMessage:c.message})}},a}return Object(s.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.updateActivePollFromProps()}},{key:"componentDidUpdate",value:function(){this.updateActivePollFromProps()}},{key:"render",value:function(){var e=this.props.ballots,a=this.state,n=a.activePoll,r=a.errorMessage,o=a.winnerIds,i=t.getPollSortedBallotsArray({poll:n,ballots:e});return l.a.createElement("div",null,l.a.createElement("h1",null,"<Results />"),l.a.createElement("h2",null,i.length," ballot",1===i.length?"":"s"),l.a.createElement("ul",null,i.map(function(e){return l.a.createElement("li",{key:e.id},l.a.createElement("em",null,new Date(e.dateSubmitted).toLocaleString()),l.a.createElement("br",null),l.a.createElement("pre",null,JSON.stringify(e)))})),l.a.createElement("button",{onClick:this.handleClickCalculateWinners},"Calculate winners"),!!o.length&&l.a.createElement("div",{className:"Results__winners"},l.a.createElement("strong",null,"Congratulations!"),l.a.createElement("ul",null,o.map(function(e){var t=n.candidates.find(function(t){return t.id===e});return t?l.a.createElement("li",{key:t.id},t.name):null}))),r&&l.a.createElement("div",{className:"Results__errorMessage"},r))}}]),t}(n.Component);M.getPollSortedBallotsArray=function(e){var t=e.poll,a=e.ballots;return console.log({poll:t,ballots:Object.values(a)}),Object.entries(a).filter(function(e){var a=Object(b.a)(e,2),n=(a[0],a[1]);return n&&n.pollId===t.id}).sort(function(e,t){var a=Object(b.a)(e,2),n=(a[0],a[1]),l=Object(b.a)(t,2),r=(l[0],l[1]);return n.dateSubmitted>r.dateSubmitted?-1:1}).map(function(e){var t=Object(b.a)(e,2);t[0];return t[1]})},M.getRoundVotes=function(e){var t=e.ballotsArray,a=e.round,n=void 0===a?0:a;return t.reduce(function(e,t){var a=t.candidateRanks;if(a.length>n){var l=a[n];e[l]=(e[l]||0)+1}return e},{})},M.calculateResults=function(e){var t=e.ballotsArray,a=e.candidates,n=e.roundIndex,l=void 0===n?1:n,r=e.winningThreshold,o=M.getRoundVotes({ballotsArray:t}),i=a.map(function(e){return e.id});if(!i.length&&1===l)throw new Error("Coulnd't find any candidates.");if(!i.length)throw new Error("All candidates have been eliminated.");var c=i.filter(function(e){return o[e]&&o[e]>r});if(c.length)return{winnerIds:c};var d=i.reduce(function(e,t){var a=o[t]||0;return e=(e="number"===typeof e?e:a)<=a?e:a},null),u=a.map(function(e){return e.id}).filter(function(e){return(o[e]||0)===d}),s=Object(C.a)(t);if(!u.length)throw new Error("Couldn't determine losers to remove for next round");var p=a.filter(function(e){return u.indexOf(e.id)<0});s=s.map(function(e){return Object(h.a)({},e,{candidateRanks:e.candidateRanks.filter(function(e){return u.indexOf(e)<0})})});try{return M.calculateResults({ballotsArray:s,candidates:p,roundIndex:l+1,winningThreshold:r})}catch(m){if("All candidates have been eliminated."===m.message)return{winnerIds:i};throw m}},M.contextType=m;var T=M,J=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(l)))).state={tab:"pollForm"},a.handleClickSetTab=function(e){return function(t){return a.setState({tab:e})}},a}return Object(s.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.auth,Object(p.a)(e,["auth"])),a=this.state.tab;return l.a.createElement("div",t,l.a.createElement("div",{className:"tabs"},l.a.createElement("button",{className:"tab",onClick:this.handleClickSetTab("pollForm")},"Poll editor"),l.a.createElement("button",{className:"tab",onClick:this.handleClickSetTab("ballot")},"Ballot"),l.a.createElement("button",{className:"tab",onClick:this.handleClickSetTab("results")},"Results")),"pollForm"===a&&l.a.createElement(B,null,l.a.createElement(f,null,l.a.createElement(v,null),l.a.createElement(I,null))),"ballot"===a&&l.a.createElement(B,null,l.a.createElement(f,null,l.a.createElement(v,null),l.a.createElement(U,null,l.a.createElement(x,null)))),"results"===a&&l.a.createElement(B,null,l.a.createElement(f,null,l.a.createElement(v,null),l.a.createElement(U,null,l.a.createElement(T,null)))))}}]),t}(n.Component),q=function(e){function t(){return Object(i.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return l.a.createElement("div",{className:"App"},l.a.createElement(J,null))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(l.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[16,1,2]]]);
//# sourceMappingURL=main.658051f7.chunk.js.map